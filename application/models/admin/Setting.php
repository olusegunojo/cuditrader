<?php
defined('BASEPATH') OR exit('');

/**
 * Description of Unit
 *
 * @author S. Olusegun Ojo <solusegunojo@gmail.com>
 * @date 5th September, 2018
 */
class Setting extends CI_Model{
    public function __construct(){
        parent::__construct();
    }
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * 
     * 
     */
    public function addSetting($setting, $value){
        $data = ['setting'=>$setting, 'value'=>$value];
        
        //set the datetime based on the db driver in use
        // $this->db->platform() == "sqlite3" 
        //         ? 
        // $this->db->set('created_on', "datetime('now')", FALSE) 
        //         : 
        // $this->db->set('created_on', "NOW()", FALSE);
        
        $this->db->insert('settings', $data);
        
        if($this->db->affected_rows() > 0){
            return $this->db->insert_id();
        }
        
        else{
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * Get details about a loan unit
     * @param type $id
     * @return boolean
     */
    public function get_setting_info($id){
        // $this->db->select('id, name, description');
        $this->db->where('id', $id);

        $run_q = $this->db->get('settings');

        if($run_q->num_rows() > 0){
            return $run_q->result();
        }

        else{
            return FALSE;
        }
    }




   /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * 
     * @param type $orderBy
     * @param type $orderFormat
     * @param type $start
     * @param type $limit
     * @return boolean
     */
    public function getAllSettings($orderBy = "setting", $orderFormat = "ASC", $start = 0, $limit = ""){
        // $this->db->select('id, first_name, last_name, email, phone, address, created_on, last_login, active, deleted');
        $this->db->limit($limit, $start);
        $this->db->order_by($orderBy, $orderFormat);
        
        $run_q = $this->db->get('settings');
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
  
   /**
    * 
    * @param type $user_id
    * @param type $new_value
    * @return boolean
    */
    public function deleteSetting($id){       
        $this->db->where('id', $id);
        // $this->db->update('settings', ['deleted'=>$new_value]);
        $this->db->delete('settings');
       
        if($this->db->affected_rows()){
            return TRUE;
        }

        else{
            return FALSE;
        }
   }


    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
   
   
    /**
     * 
     * @param type $value
     * @return boolean
     */
    public function settingSearch($value){
        $q = "SELECT * FROM settings WHERE 
                -- id != {$_SESSION['user_id']}
                --     AND
                (
                MATCH(setting) AGAINST(?)
                || setting LIKE '%".$this->db->escape_like_str($value)."%'
                || value LIKE '%".$this->db->escape_like_str($value)."%'
                )";

        $run_q = $this->db->query($q, [$value, $value]);

        if($run_q->num_rows() > 0){
            return $run_q->result();
        }

        else{
            return FALSE;
        }
    }
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    public function updateSetting($id, $setting, $value){
        $data = ['setting'=>$setting, 'value'=>$value];
        
        $this->db->where('id', $id);
        
        return $this->db->update('settings', $data);
        
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
/*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * 
     * @param type $f_name
     * @param type $l_name
     * @param type $email
     * @param type $password
     * @param type $mobile
     * @param type $addr
     * @return boolean
     */
    public function addTenor($tenor, $display){
        $data = ['tenor'=>$tenor, 'display'=>$display];
        
        //set the datetime based on the db driver in use
        // $this->db->platform() == "sqlite3" 
        //         ? 
        // $this->db->set('created_on', "datetime('now')", FALSE) 
        //         : 
        // $this->db->set('created_on', "NOW()", FALSE);
        
        $this->db->insert('loan_tenors', $data);
        
        if($this->db->affected_rows() > 0){
            return $this->db->insert_id();
        }
        
        else{
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * Get details about a collateral unit
     * @param type $id
     * @return boolean
     */
    public function get_tenor_info($id){
        $this->db->where('id', $id);

        $run_q = $this->db->get('loan_tenors');

        if($run_q->num_rows() > 0){
            return $run_q->result();
        }

        else{
            return FALSE;
        }
    }




   /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    /**
     * 
     * @param type $orderBy
     * @param type $orderFormat
     * @param type $start
     * @param type $limit
     * @return boolean
     */
    public function getAllTenors($orderBy = "tenor", $orderFormat = "ASC", $start = 0, $limit = ""){
        $this->db->limit($limit, $start);
        $this->db->order_by($orderBy, $orderFormat);
        
        $run_q = $this->db->get('loan_tenors');
        
        if($run_q->num_rows() > 0){
            return $run_q->result();
        }
        
        else{
            return FALSE;
        }
    }
    
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
  
   /**
    * 
    * @param type $user_id
    * @param type $new_value
    * @return boolean
    */
    public function deleteTenor($id){       
        $this->db->where('id', $id);
        $this->db->delete('loan_tenors');
       
        if($this->db->affected_rows()){
            return TRUE;
        }

        else{
            return FALSE;
        }
   }


    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
   
   
    /**
     * 
     * @param type $value
     * @return boolean
     */
    public function tenorSearch($value){
        $q = "SELECT * FROM loan_tenors WHERE 
                -- id != {$_SESSION['user_id']}
                --     AND
                (
                MATCH(display) AGAINST(?)
                || display LIKE '%".$this->db->escape_like_str($value)."%'
                )";

        $run_q = $this->db->query($q, [$value, $value]);

        if($run_q->num_rows() > 0){
            return $run_q->result();
        }

        else{
            return FALSE;
        }
    }
    
    /*
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    ********************************************************************************************************************************
    */
    
    public function updateTenor($id, $tenor, $display){
        $data = ['tenor'=>$tenor, 'display'=>$display];
        
        $this->db->where('id', $id);
        
        return $this->db->update('loan_tenors', $data);
    }
    
   
}
